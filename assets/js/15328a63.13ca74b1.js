"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3347],{35252:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>h});var i=t(85893),o=t(11151),s=t(19965),c=t(44996);const r={sidebar_position:4},a="Configure OpenID connect identity providers",l={id:"guides/oidc-IAM",title:"Configure OpenID connect identity providers",description:"We support any OpenID compliant identity provider and also GitHub authN",source:"@site/versioned_docs/version-0.4.x/guides/04-oidc-IAM.md",sourceDirName:"guides",slug:"/guides/oidc-IAM",permalink:"/interLink/docs/0.4.x/guides/oidc-IAM",draft:!1,unlisted:!1,editUrl:"https://github.com/interlink-hq/interLink/versioned_docs/version-0.4.x/guides/04-oidc-IAM.md",tags:[],version:"0.4.x",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"OpenAPI references",permalink:"/interLink/docs/0.4.x/guides/api-reference"},next:{title:"InterLink Monitoring System",permalink:"/interLink/docs/0.4.x/guides/monitoring"}},d={},h=[{value:"GitHub authN",id:"github-authn",level:2},{value:"Requirements",id:"requirements",level:3},{value:"Create an OAuth GitHub app",id:"create-an-oauth-github-app",level:3},{value:"EGI Check-in",id:"egi-check-in",level:2},{value:"Indigo IAM",id:"indigo-iam",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"configure-openid-connect-identity-providers",children:"Configure OpenID connect identity providers"}),"\n",(0,i.jsx)(n.p,{children:"We support any OpenID compliant identity provider and also GitHub authN\nworkflow."}),"\n",(0,i.jsx)(n.h2,{id:"github-authn",children:"GitHub authN"}),"\n",(0,i.jsx)(n.h3,{id:"requirements",children:"Requirements"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"kubectl host"}),": an host with MiniKube installed and running"]}),"\n",(0,i.jsx)(n.li,{children:"A GitHub account"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"remote host"}),': A "remote" machine with a port that is reachable by the\nMiniKube host']}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"create-an-oauth-github-app",children:"Create an OAuth GitHub app"}),"\n",(0,i.jsx)(n.p,{children:"As a first step, you need to create a GitHub OAuth application to allow\ninterLink to make authentication between your Kubernetes cluster and the remote\nendpoint."}),"\n",(0,i.jsxs)(n.p,{children:["Head to ",(0,i.jsx)(n.a,{href:"https://github.com/settings/apps",children:"https://github.com/settings/apps"})," and\nclick on ",(0,i.jsx)(n.code,{children:"New GitHub App"}),". You should now be looking at a form like this:"]}),"\n",(0,i.jsx)(s.Z,{alt:"Docusaurus themed image",sources:{light:(0,c.Z)("/img/github-app-new.png"),dark:(0,c.Z)("/img/github-app-new.png")}}),"\n",(0,i.jsxs)(n.p,{children:["Provide a name for the OAuth2 application, e.g. ",(0,i.jsx)(n.code,{children:"interlink-demo-test"}),", and you\ncan skip the description, unless you want to provide one for future reference.\nFor our purpose Homepage reference is also not used, so fill free to put there\n",(0,i.jsx)(n.code,{children:"https://interlink-hq.github.io/interLink/"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Check now that refresh token and device flow authentication:"}),"\n",(0,i.jsx)(s.Z,{alt:"Docusaurus themed image",sources:{light:(0,c.Z)("/img/github-app-new2.png"),dark:(0,c.Z)("/img/github-app-new2.png")}}),"\n",(0,i.jsxs)(n.p,{children:["Disable webhooks and save clicking on ",(0,i.jsx)(n.code,{children:"Create GitHub App"})]}),"\n",(0,i.jsx)(s.Z,{alt:"Docusaurus themed image",sources:{light:(0,c.Z)("/img/github-app-new3.png"),dark:(0,c.Z)("/img/github-app-new3.png")}}),"\n",(0,i.jsxs)(n.p,{children:["You can click then on your application that should now appear at\n",(0,i.jsx)(n.a,{href:"https://github.com/settings/apps",children:"https://github.com/settings/apps"})," and you\nneed to save two strings: the ",(0,i.jsx)(n.code,{children:"Client ID"})," and clicking on\n",(0,i.jsx)(n.code,{children:"Generate a new client secret"})," you should be able to note down the relative\n",(0,i.jsx)(n.code,{children:"Client Secret"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Now it's all set for the next steps. You should be able to set it for\nauthenticating the virtual kubelet with the interLink remote components with the\nfollowing piece of the installer configuration:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'oauth:\n  provider: github\n  issuer: https://github.com/oauth\n  grant_type: authorization_code\n  scopes:\n    - "read:user"\n  github_user: "GH USERNAME HERE"\n  token_url: "https://github.com/login/oauth/access_token"\n  device_code_url: "https://github.com/login/device/code"\n  client_id: "XXXXXXX"\n  client_secret: "XXXXXXXX"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"egi-check-in",children:"EGI Check-in"}),"\n",(0,i.jsxs)(n.p,{children:["If you have an account for ",(0,i.jsx)(n.a,{href:"https://aai.egi.eu",children:"EGI check-in"}),", you should be\nable to set it for authenticating the virtual kubelet with the interLink remote\ncomponents with the following piece of the installer configuration:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'oauth:\n  provider: oidc\n  issuer: https://aai.egi.eu/auth/realms/egi\n  scopes:\n    - "openid"\n    - "email"\n    - "offline_access"\n    - "profile"\n  audience: interlink\n  grant_type: authorization_code\n  group_claim: email\n  group: "YOUR EMAIL HERE"\n  token_url: "https://aai.egi.eu/auth/realms/egi/protocol/openid-connect/token"\n  device_code_url: "https://aai.egi.eu/auth/realms/egi/protocol/openid-connect/auth/device"\n  client_id: "oidc-agent"\n  client_secret: ""\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"danger",children:(0,i.jsx)(n.p,{children:"Remember to put your email in the group field!"})}),"\n",(0,i.jsx)(n.h2,{id:"indigo-iam",children:"Indigo IAM"}),"\n",(0,i.jsxs)(n.p,{children:["If you have an account for ",(0,i.jsx)(n.a,{href:"https://iam.cloud.infn.it/",children:"Indigo IAM"}),", you should\nbe able to set it for authenticating the virtual kubelet with the interLink\nremote components. Follow those steps to setup a new client in the IAM portal\nand get the necessary information to fill the configuration. This guide is\nspecific for the IAM portal\n",(0,i.jsx)(n.a,{href:"https://iam.cloud.infn.it/",children:"https://iam.cloud.infn.it/"})," but it should be\nsimilar for other IAM portals that are OpenID compliant."]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Go to the ",(0,i.jsx)(n.a,{href:"https://iam.cloud.infn.it/",children:"IAM portal"})," and log in."]}),"\n",(0,i.jsxs)(n.li,{children:["After logging in, click on the ",(0,i.jsx)(n.code,{children:"My clients"})," tab on the left side of the page\nand then select ",(0,i.jsx)(n.code,{children:"New client"})," as shown in the images below."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"Go to my clients",src:t(75175).Z+"",width:"400",height:"481"}),"\n",(0,i.jsx)(n.img,{alt:"Create a new client",src:t(88805).Z+"",width:"400",height:"481"})," 3. Set a name you prefer for the\nclient. 4. Select the ",(0,i.jsx)(n.code,{children:"Scopes"})," tab and add the following scopes: ",(0,i.jsx)(n.code,{children:"openid"}),",\n",(0,i.jsx)(n.code,{children:"email"}),", ",(0,i.jsx)(n.code,{children:"offline_access"}),", ",(0,i.jsx)(n.code,{children:"profile"}),", ",(0,i.jsx)(n.code,{children:"wlcg"}),", ",(0,i.jsx)(n.code,{children:"wlcg.groups"}),". 5. Select the\n",(0,i.jsx)(n.code,{children:"Grant types"})," tab and add the following grant types: ",(0,i.jsx)(n.code,{children:"authorization_code"}),",\n",(0,i.jsx)(n.code,{children:"client_credentials"}),", ",(0,i.jsx)(n.code,{children:"refresh_token"}),",\n",(0,i.jsx)(n.code,{children:"urn:ietf:params:oauth:grant-type:device_code"}),". 6. Save the client by pressing\nthe ",(0,i.jsx)(n.code,{children:"Save client"})," button."]}),"\n",(0,i.jsxs)(n.p,{children:["After creating the client, you will be able to see the new client in the\n",(0,i.jsx)(n.code,{children:"My clients"})," page as show in the image below."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Check the created client",src:t(18066).Z+"",width:"400",height:"398"})}),"\n",(0,i.jsxs)(n.p,{children:["You can click on the client to see the client details. You will find the\n",(0,i.jsx)(n.code,{children:"Client id"})," under the ",(0,i.jsx)(n.code,{children:"Main"})," tab and the ",(0,i.jsx)(n.code,{children:"Client secret"})," under the ",(0,i.jsx)(n.code,{children:"Credentials"}),"\ntab. Now, with those information, you can fill this piece of the installer\nconfiguration:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'oauth:\n  provider: oidc\n  issuer: "https://iam.cloud.infn.it/"\n  scopes:\n    - "openid"\n    - "email"\n    - "offline_access"\n    - "profile"\n  audience: users\n  grant_type: authorization_code\n  group_claim: email\n  group: "YOUR EMAIL HERE"\n  token_url: "https://iam.cloud.infn.it/token"\n  device_code_url: "https://iam.cloud.infn.it/devicecode"\n  client_id: "YOUR CLIENT ID HERE"\n  client_secret: "YOUR CLIENT SECRET HERE"\n'})})]})}function p(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},75175:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/iam-client0-62f54d6f030fe5df69ec51e75f6954b8.png"},88805:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/iam-client1-c3dac9bf303a9023c55965715699268a.png"},18066:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/iam-client2-22f4aaacc11fc9a2d7dd1321fb1ac198.png"},11151:(e,n,t)=>{t.d(n,{Z:()=>r,a:()=>c});var i=t(67294);const o={},s=i.createContext(o);function c(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);