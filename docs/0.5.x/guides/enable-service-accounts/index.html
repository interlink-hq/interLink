<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-0.5.x docs-doc-page docs-doc-id-guides/enable-service-accounts" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Enable service accounts | interLink</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://interlink-hq.github.io/interLink/img/img/interlink_logo.png"><meta data-rh="true" name="twitter:image" content="https://interlink-hq.github.io/interLink/img/img/interlink_logo.png"><meta data-rh="true" property="og:url" content="https://interlink-hq.github.io/interLink/docs/0.5.x/guides/enable-service-accounts"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="0.5.x"><meta data-rh="true" name="docusaurus_tag" content="docs-default-0.5.x"><meta data-rh="true" name="docsearch:version" content="0.5.x"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-0.5.x"><meta data-rh="true" property="og:title" content="Enable service accounts | interLink"><meta data-rh="true" name="description" content="By default, InterLink does not translate Kubernetes Service Accounts from Pod into Plugin. That means workload that needs to interact with Kubernetes API like Argo will not work."><meta data-rh="true" property="og:description" content="By default, InterLink does not translate Kubernetes Service Accounts from Pod into Plugin. That means workload that needs to interact with Kubernetes API like Argo will not work."><link data-rh="true" rel="icon" href="/interLink/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://interlink-hq.github.io/interLink/docs/0.5.x/guides/enable-service-accounts"><link data-rh="true" rel="alternate" href="https://interlink-hq.github.io/interLink/docs/0.5.x/guides/enable-service-accounts" hreflang="en"><link data-rh="true" rel="alternate" href="https://interlink-hq.github.io/interLink/docs/0.5.x/guides/enable-service-accounts" hreflang="x-default"><link rel="stylesheet" href="/interLink/assets/css/styles.491ac64f.css">
<script src="/interLink/assets/js/runtime~main.6a7404f1.js" defer="defer"></script>
<script src="/interLink/assets/js/main.cad3d92c.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="content_knG7 announcementBarContent_xLdY">We are onboarding for our contribution to CNCF Sandbox! Please let us know for any broken or missing information as we move to the new home.</div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/interLink/"><div class="navbar__logo"><img src="/interLink/img/interlink_logo.png" alt="interLink Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/interLink/img/interlink_logo.png" alt="interLink Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Home</b></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/interLink/docs/0.5.x/intro">0.5.x</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/interLink/docs/next/guides/enable-service-accounts">Next</a></li><li><a class="dropdown__link" href="/interLink/docs/guides/enable-service-accounts">0.4.x</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/interLink/docs/0.5.x/guides/enable-service-accounts">0.5.x</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/interLink/docs/0.5.x/intro">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/interlink-hq/interLink" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/interLink/docs/0.5.x/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/interLink/docs/0.5.x/arch">Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/interLink/docs/0.5.x/category/cookbook">Cookbook</a><button aria-label="Expand sidebar category &#x27;Cookbook&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/interLink/docs/0.5.x/category/admin-guides">Admin guides</a><button aria-label="Collapse sidebar category &#x27;Admin guides&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interLink/docs/0.5.x/guides/deploy-interlink">Deploy your plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interLink/docs/0.5.x/guides/develop-a-plugin">Develop an interLink plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interLink/docs/0.5.x/guides/api-reference">OpenAPI references</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interLink/docs/0.5.x/guides/oidc-IAM">Configure OpenID connect identity providers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interLink/docs/0.5.x/guides/monitoring">InterLink Monitoring System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/interLink/docs/0.5.x/guides/enable-service-accounts">Enable service accounts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interLink/docs/0.5.x/guides/mtls-deployment">mTLS Deployment Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interLink/docs/0.5.x/guides/systemd-deployment">Systemd Deployment Guide</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/interLink/docs/0.5.x/Developers">Developers guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/interLink/docs/0.5.x/Limitations">Current limitations</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->interLink<!-- --> <b>0.5.x</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/interLink/docs/guides/enable-service-accounts">latest version</a></b> (<!-- -->0.4.x<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/interLink/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/interLink/docs/0.5.x/category/admin-guides"><span itemprop="name">Admin guides</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Enable service accounts</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 0.5.x</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Enable service accounts</h1>
<p>By default, InterLink does not translate Kubernetes Service Accounts from Pod into Plugin. That means workload that needs to interact with Kubernetes API like Argo will not work.</p>
<p>However after following deployment and configuration in this guide, InterLink will give means for Plugin for that. A test has been done with InterLink Slurm Plugin and Argo.</p>
<p>There are two parts on this guide: how to deploy means to access Kubernetes API service from external cluster network, and how to configure InterLink so that Plugin can access it.</p>
<p>The prerequisite of this guide are:</p>
<ul>
<li>provide an external way to access Kubernetes API service (out of scope of InterLink, but an example is written below)</li>
<li>provide certificates (that can be self-signed), and its CA root certificate (also out of scope of InterLink, but an example is written below)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="provide-an-external-way-to-access-kubernetes-api-service">Provide an external way to access Kubernetes API service<a href="#provide-an-external-way-to-access-kubernetes-api-service" class="hash-link" aria-label="Direct link to Provide an external way to access Kubernetes API service" title="Direct link to Provide an external way to access Kubernetes API service">​</a></h2>
<p>By default, InterLink Plugin containers cannot access Kubernetes internal network. Thus they cannot access Kubernetes API service (<code>kubernetes.default.svc.cluster.local</code>). Kubernetes offers ways to access internal services (see <a href="https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types</a>):</p>
<ul>
<li>LoadBalancer</li>
<li>NodePort</li>
<li>...</li>
</ul>
<p>Because this is highly dependent of the Kubernetes cluster infrastructure, this deployment is out of scope of InterLink automatic deployment. However, below are examples of how and what to deploy, using ingress. This requires a bit of Ingress knowledge as prerequisite.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="design-of-ingress-use">Design of ingress use<a href="#design-of-ingress-use" class="hash-link" aria-label="Direct link to Design of ingress use" title="Direct link to Design of ingress use">​</a></h3>
<p>The Kubernetes cluster can already contain an Ingress resource to let external access to web services. However it is a best-practice to separate internal (meaning flow between Kubernetes and Plugin infrastructure, like Slurm machines) and external flows (meaning flow between Kubernetes and the world).</p>
<p>This guide will thus deploy as an example another ingress separate from the already existing ingress, if it exist. This also works if there is no ingress yet.</p>
<p>Here is a diagram (generated with <a href="https://asciiflow.com" target="_blank" rel="noopener noreferrer">https://asciiflow.com</a>) with Interlink Slurm Plugin as example. This Kubernetes cluster is deployed next to a Slurm cluster, but it can also be deployed on cloud.</p>
<p>Because Ingress can only serve services in the same namespace, and because Kubernetes API is in default namespace, different from the Ingress &quot;ingress-nginx-internal&quot;, a reverse-proxy NGINX HTTPS is instantiated to make Kubernetes API available to Ingress.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">       ┌───────────────────────────┐                               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       │                           │                               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       │   Kubernetes cluster      │                               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       │┌────────┐   ┌───────────┐ │                               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ││K8S API ├───┤Nginx HTTPS│ │                               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       │└────────┘   └─────┬─────┘ │                               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       │                   │       │               Slurm cluster   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       └─┬─────────────────┼───────┘                     │         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │Ingress          │Ingress            ──────────┴─────────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │TCP 80, 443      │TCP 6080, 60443      Slurm network     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ┌─────┴────┐        ┌───┴──────┐            ──────────┬─────────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │ External │        │ Internal │                      │         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │ Firewall │        │ Firewall │                      │         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   └─────┬────┘        └───┬──────┘       ┌────────┐     │         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                 └──────────────┤ Router ├─────┘         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   xxxxxxxxx xxxx                         └────────┘               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   x       xxx  xxx                                                </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  xx              x                                                </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> xx  Internet     x                                                </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x            xxxxx                                                 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x   x           xx                                                 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xxxxxxx       xxx                                                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      xxxxxxxxx                                                    </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="nginx-https">NGINX HTTPS<a href="#nginx-https" class="hash-link" aria-label="Direct link to NGINX HTTPS" title="Direct link to NGINX HTTPS">​</a></h3>
<p>This deploys a reverse-proxy.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF | tee ./nginx-values.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serverBlock: |-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen 0.0.0.0:60443;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    real_ip_header X-Forwarded-For;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    set_real_ip_from 0.0.0.0/0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resolver kube-dns.kube-system.svc.cluster.local valid=30s;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    set $upstream https://kubernetes.default.svc.cluster.local:443;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      proxy_pass $upstream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Avoid LoadBalancer type, to avoid external IP.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type: &quot;ClusterIP&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    http: 60443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">containerPorts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  http: 60443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade --install --create-namespace -n ingress-nginx-internal --version 16.0.3 my-nginx-kubernetes-api bitnami/nginx --values ./nginx-values.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="kind-cluster">KIND cluster<a href="#kind-cluster" class="hash-link" aria-label="Direct link to KIND cluster" title="Direct link to KIND cluster">​</a></h4>
<p>Deploy KIND specific ingress-nginx ingress:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Replace by the target Chart helm version, see https://artifacthub.io/packages/helm/ingress-nginx/ingress-nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helmIngressNginx=4.11.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade --install my-ingress-nginx ingress-nginx/ingress-nginx --create-namespace -n ingress-nginx-internal --version &quot;${helmIngressNginx}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --values https://raw.githubusercontent.com/kubernetes/ingress-nginx/helm-chart-&quot;${helmIngressNginx}&quot;/hack/manifest-templates/provider/kind/values.yaml \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --set controller.allowSnippetAnnotations=true \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --set controller.hostPort.ports.http=6080 --set controller.hostPort.ports.https=60443 --set controller.ingressClassResource=nginx-internal</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then in KIND map the network ports like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kind: Cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: kind.x-k8s.io/v1alpha4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">networking:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # ipv6 not needed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ipFamily: ipv4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeadmConfigPatches:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kind: KubeletConfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # See https://github.com/kubernetes-sigs/kind/issues/3359</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  localStorageCapacityIsolation: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#name: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nodes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># one node hosting a control plane</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- role: control-plane</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ingress-ready: &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # For ingress: https://kind.sigs.k8s.io/docs/user/ingress/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># kubeadmConfigPatches:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># - |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#   kind: InitConfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#   nodeRegistration:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     kubeletExtraArgs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#       node-labels: &quot;ingress-ready=true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  extraPortMappings:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - containerPort: 6080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostPort: 6080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - containerPort: 60443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostPort: 60443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- role: worker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="cloud-cluster">Cloud cluster<a href="#cloud-cluster" class="hash-link" aria-label="Direct link to Cloud cluster" title="Direct link to Cloud cluster">​</a></h4>
<p>Deploy ingress and uses the Cloud Provider specific Loadbalancer (GCP, AWS, etc.). One can deploy ingress-nginx like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Replace by the target Chart helm version, see https://artifacthub.io/packages/helm/ingress-nginx/ingress-nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helmIngressNginx=4.11.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade --install my-ingress-nginx ingress-nginx/ingress-nginx --create-namespace -n ingress-nginx-internal --version &quot;${helmIngressNginx}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --set controller.hostPort.ports.http=6080 --set controller.hostPort.ports.https=60443 --set controller.ingressClassResource=nginx-internal</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="baremetal-cluster">Baremetal cluster<a href="#baremetal-cluster" class="hash-link" aria-label="Direct link to Baremetal cluster" title="Direct link to Baremetal cluster">​</a></h4>
<p>Deploy the MetalLB loadbalancer (see <a href="https://metallb.io/" target="_blank" rel="noopener noreferrer">https://metallb.io/</a>).
This has some network prerequisites (like network in promiscuous mode, and dedicated IPs pools).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="provide-https-certificate-and-its-ca-certificate">Provide HTTPS certificate and its CA certificate<a href="#provide-https-certificate-and-its-ca-certificate" class="hash-link" aria-label="Direct link to Provide HTTPS certificate and its CA certificate" title="Direct link to Provide HTTPS certificate and its CA certificate">​</a></h2>
<p>Kubernetes API service can only be accessed using encrypted HTTPS flow. Kubelet is normally responsible for providing <code>ca.crt</code> file that matches the Kubernetes API URL that it provides to containers: for example</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">KUBERNETES_PORT=tcp://10.96.0.1:443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KUBERNETES_SERVICE_PORT=443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KUBERNETES_PORT_443_TCP_PORT=443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KUBERNETES_PORT_443_TCP_PROTO=tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KUBERNETES_SERVICE_PORT_HTTPS=443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KUBERNETES_SERVICE_HOST=10.96.0.1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The former section describe how to access Kubernetes API externally, so an appropriate certificate needs to be generated. In this page, one convenient way to generate is to use certmanager.</p>
<p>It is possible to use any third-party service (like Let&#x27;s Encrypt) to generate certificates signed by a public root CA, and thus InterLink Virtual-Kubelet would not need to distribute a <code>ca.crt</code> because root CA certificates are part of the OS of container image (if they are up to date).</p>
<p>However, it is better and more convenient to generate certificates from an internal CA that has a self-signed certificate. Here is an example of how to deploy a certmanager:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">certManagerChartVersion=&quot;v1.14.5&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/${certManagerChartVersion}/cert-manager.crds.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add jetstack https://charts.jetstack.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade -i -n cert-manager cert-manager --create-namespace jetstack/cert-manager --wait --version &quot;${certManagerChartVersion}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF | kubectl apply -n cert-manager -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: cert-manager.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ClusterIssuer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: selfsigned-root-issuer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selfSigned: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: cert-manager.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Certificate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: ingress-nginx-internal-root-ca</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  isCA: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  commonName: ingress-nginx-internal-root-ca</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  secretName: ingress-nginx-internal-root-ca-secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # To avoid rotation issue, 100 years = 100 * 365 * 24 h = 876000h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  duration: &quot;876000h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  privateKey:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    algorithm: ECDSA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    size: 256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  issuerRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: selfsigned-root-issuer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kind: ClusterIssuer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    group: cert-manager.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: cert-manager.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Issuer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: selfsigned-issuer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ca:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    secretName: ingress-nginx-internal-root-ca-secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> #selfSigned: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-ingress">Configure Ingress<a href="#configure-ingress" class="hash-link" aria-label="Direct link to Configure Ingress" title="Direct link to Configure Ingress">​</a></h3>
<p>Given the previous sections, the final step to provide access to Kubernetes API service, with a HTTPS certificate is to provide an ingress resource. Here is an example for KIND cluster, to be adapter for other types:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">items:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- apiVersion: networking.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kind: Ingress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      acme.cert-manager.io/http01-edit-in-place: &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # To avoid rotation issue, 100 years = 100 * 365 * 24 h = 876000h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      cert-manager.io/duration: 876000h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      cert-manager.io/issuer: selfsigned-issuer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    namespace: ingress-nginx-internal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Must match the ingress controller ingress class name.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ingressClassName: nginx-internal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - http:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        paths:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - backend:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            service:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              name: my-nginx-kubernetes-api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              port:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                number: 60443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          path: /api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          pathType: Prefix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - http:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        paths:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - backend:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            service:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              name: my-nginx-kubernetes-api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              port:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                number: 60443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          path: /apis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          pathType: Prefix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tls:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - hosts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - A.B.C.D # IP of the machine hosting KIND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      secretName: web-ssl-kubernetes-api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  status:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loadBalancer:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ingress:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - hostname: localhost</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Please note that the certificates are generated for 100 years in order to not having rotation issue.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-interlink-helm-chart">Configure InterLink Helm Chart<a href="#configure-interlink-helm-chart" class="hash-link" aria-label="Direct link to Configure InterLink Helm Chart" title="Direct link to Configure InterLink Helm Chart">​</a></h2>
<p>When deploying following deployment installation, at helm install, please add Kubernetes API configuration as follow:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Contains the certificate of the service automatically created by certmanager, than contains, for this example, the IP address in SAN field.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubernetesApiCaCrt=&quot;$(kubectl get secret -n ingress-nginx-internal web-ssl-kubernetes-api -o jsonpath=&#x27;{.data.ca\.crt}&#x27;|base64 -d)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade --install \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --create-namespace \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -n interlink \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --set &quot;interlink.kubernetesApiAddr=A.B.C.D&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --set &quot;interlink.kubernetesApiPort=60443&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --set &quot;interlink.kubernetesApiCaCrt=${kubernetesApiCaCrt}&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-your-setup">Test your setup<a href="#test-your-setup" class="hash-link" aria-label="Direct link to Test your setup" title="Direct link to Test your setup">​</a></h2>
<p>Please apply this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF | kubectl apply -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: batch/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: helloworld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template: # create pods using pod definition in this template</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app: helloworld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        slurm-job.vk.io/image-root: &quot;docker://&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      nodeSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # The name of the virtual node HERE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        kubernetes.io/hostname: interlink-slurm-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      affinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        nodeAffinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          preferredDuringSchedulingIgnoredDuringExecution:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - weight: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            preference:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              matchExpressions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - key: &quot;kubernetes.io/hostname&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                operator: In</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                values:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                - interlink-slurm-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tolerations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - key: virtual-node.interlink/no-schedule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        operator: Exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      restartPolicy: Never</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: helloworld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image: docker.io/bitnami/kubectl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        command:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - &quot;kubectl&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - &quot;auth&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - &quot;can-i&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - &quot;--list&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tty: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cpu: &quot;50m&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            memory: &quot;100Mi&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          limits:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cpu: &quot;1500m&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            memory: &quot;2000Mi&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs job/helloworld -f</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The expected output should be describe the RBAC related to the default serviceAccount, similar to this</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Resources                                       Non-Resource URLs                      Resource Names   Verbs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">selfsubjectreviews.authentication.k8s.io        []                                     []               [create]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">selfsubjectaccessreviews.authorization.k8s.io   []                                     []               [create]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">selfsubjectrulesreviews.authorization.k8s.io    []                                     []               [create]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                [/.well-known/openid-configuration/]   []               [get]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                [/.well-known/openid-configuration]    []               [get]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                [/api/*]                               []               [get]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                [/api]                                 []               [get]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                [/apis/*]                              []               [get]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                [/apis]                                []               [get]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                [/healthz]                             []               [get]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                [/healthz]                             []               [get]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                [/livez]                               []               [get]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                [/livez]                               []               [get]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                [/openapi/*]                           []               [get]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                [/openapi]                             []               [get]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                [/openid/v1/jwks/]                     []               [get]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                [/openid/v1/jwks]                      []               [get]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                [/readyz]                              []               [get]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                [/readyz]                              []               [get]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                [/version/]                            []               [get]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                [/version/]                            []               [get]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                [/version]                             []               [get]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                [/version]                             []               [get]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/interlink-hq/interLink/versioned_docs/version-0.5.x/guides/06-enable-service-accounts.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/interLink/docs/0.5.x/guides/monitoring"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">InterLink Monitoring System</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/interLink/docs/0.5.x/guides/mtls-deployment"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">mTLS Deployment Guide</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#provide-an-external-way-to-access-kubernetes-api-service" class="table-of-contents__link toc-highlight">Provide an external way to access Kubernetes API service</a><ul><li><a href="#design-of-ingress-use" class="table-of-contents__link toc-highlight">Design of ingress use</a></li><li><a href="#nginx-https" class="table-of-contents__link toc-highlight">NGINX HTTPS</a></li></ul></li><li><a href="#provide-https-certificate-and-its-ca-certificate" class="table-of-contents__link toc-highlight">Provide HTTPS certificate and its CA certificate</a><ul><li><a href="#configure-ingress" class="table-of-contents__link toc-highlight">Configure Ingress</a></li></ul></li><li><a href="#configure-interlink-helm-chart" class="table-of-contents__link toc-highlight">Configure InterLink Helm Chart</a></li><li><a href="#test-your-setup" class="table-of-contents__link toc-highlight">Test your setup</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/interLink/docs/intro">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/intertwin/shared_invite/zt-2cs67h9wz-2DFQ6EiSQGS1vlbbbJHctA" target="_blank" rel="noopener noreferrer" class="footer__link-item">interTwin project Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/interlink-hq/interLink" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Originally created by INFN - Copyright © interLink a Series of LF Projects, LLC.</div></div></div></footer></div>
</body>
</html>